# Verilog Sample Project

このプロジェクトはVerilogを学習するためのサンプルプロジェクトです。
以下、AIが生成した内容を含んだ、本サンプルの使い方です。

## ディレクトリ構成

```
sample-project/
├── Makefile           # ビルドとシミュレーション用のMakefile
├── src/               # Verilogソースファイル
├── sim/               # シミュレーション関連ファイル
│   ├── tb_top.v      # トップレベルテストベンチ
│   └── waveformat.sav # GTKWave設定ファイル
├── gowin/             # FPGA実装用ディレクトリ
└── tmp/               # 一時ファイル（自動生成）
```

## 必要なツール

### シミュレーション用
- **iverilog**: Verilogシミュレータ
- **vvp**: IcarusVerilogのランタイム
- **gtkwave**: 波形ビューア（オプション）

### FPGA実装用
- **Gowin EDA**: Gowin FPGA用の統合開発環境

### インストール方法

#### macOS (Homebrew)
```zsh
brew install icarus-verilog gtkwave
```

#### Ubuntu/Debian
```zsh
sudo apt-get install iverilog gtkwave
```

## 使用方法

### シミュレーション

#### 1. シミュレーションの実行
```zsh
make sim
```
このコマンドは以下を実行します：
- Verilogファイルをコンパイル
- シミュレーションを実行
- 波形データ（VCD）を生成

#### 2. 波形表示
```zsh
make wave
```
GTKWaveで波形を表示します（GTKWaveがインストールされている場合）。

#### 3. 一括実行
```zsh
make all
```
シミュレーション実行と波形表示を一度に行います。

#### 4. クリーンアップ
```zsh
make clean
```
生成された一時ファイルを削除します。

### FPGA実装

実際にFPGAに向けた論理合成、配置配線を行う場合は、以下の手順に従ってください：

#### 1. Gowin EDAプロジェクトの作成
1. `gowin/` ディレクトリ内でGowin EDAを起動
2. 新しいプロジェクトを作成
3. 対象FPGAデバイスを選択

#### 2. ソースファイルの参照設定
**重要**: `src/` フォルダ内のVerilogファイルは、Gowin EDAプロジェクトにコピーするのではなく、**参照（リンク）として追加**してください。

- プロジェクト設定でソースファイルを追加する際、ファイルをコピーするオプションは**無効**にする
- 相対パス `../src/*.v` を使用してソースファイルを参照
- これにより、シミュレーションとFPGA実装で同一のソースコードを使用可能

#### 3. 論理合成・配置配線の実行
1. **論理合成 (Synthesis)**: Verilogコードをゲートレベルに変換
2. **配置配線 (Place & Route)**: 論理回路をFPGA上に配置し、配線を決定
3. **ビットストリーム生成**: FPGA書き込み用ファイルを生成

#### 4. プロジェクト管理のベストプラクティス
- `gowin/` ディレクトリにはGowin EDA固有のファイル（.gprj, .cst等）のみを配置
- ソースコードは常に `src/` ディレクトリで管理
- 制約ファイル（.cst）はGowinプロジェクト内で管理

## ファイルの追加

### 新しいVerilogモジュールの追加
1. `src/` ディレクトリに `.v` ファイルを追加
2. 必要に応じて `sim/tb_top.v` でテストベンチを更新
3. `make sim` でシミュレーション実行
4. Gowin EDAプロジェクトでも新しいファイルを参照として追加

### カスタムテストベンチの作成
1. `sim/` ディレクトリにテストベンチファイルを追加
2. 必要に応じて `Makefile` の `TOP_TB` 変数を更新

## トラブルシューティング

### シミュレーションエラー
- Verilogの構文エラーを確認
- モジュール名とファイル名の整合性を確認
- インクルードパスが正しく設定されているか確認

### 波形が表示されない
- GTKWaveがインストールされているか確認
- VCDファイルが正常に生成されているか確認（`tmp/wave.vcd`）
- テストベンチで `$dumpfile` と `$dumpvars` が正しく設定されているか確認

### FPGA実装エラー
- ソースファイルが正しく参照されているか確認
- 制約ファイル（.cst）でピン配置が適切に設定されているか確認
- 使用しているFPGAデバイスの仕様を確認